.
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sistema Central de Participacion - IEEE Student Branch Unimagdalena</title>
    <!-- <script src="scripts/jquery-3.4.1.min.js"></script> -->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
        integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../../style/style.css">
</head>

<body class="background">
    <section class="nav-title">
        <!-- barra de titulo y navegacion  -->
        <div class="header">
            <div class="card-header">
                <div class="row mx-auto">
                    <div class="col-md-2">
                        <img src="../../resources/LOGO.png" width="40%" style="display: inherit; margin: auto">
                    </div>
                    <div class="col-md-6">
                        <a href="../../index.html" class="text-dark">
                            <h1 class="text-center title" style="margin: auto;">Sistema Central de Participacion</h1>
                        </a>
                    </div>
                    <div class="col-md-4 mx-auto d-flex justify-content-around" style="margin: auto;">
                        <a href="" class="btn btn-info btn-section"><i class="fas fa-user-friends"></i></a>
                        <a href="" class="btn btn-info btn-section"><i class="fas fa-chart-line"></i></a>
                        <a href="../eventos/eventos.html" class="btn btn-info btn-section"><i
                                class="fas fa-calendar-alt"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container mx-auto">
        <div class="row">
            <div class="col-md-6">
                <div class="header">
                    <i class="fas fa-user-friends title"></i>
                    <h2 style="display: inline-block">Personas</h2>
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-end" style="align-items: center;">
                <button class="btn btn-success" data-target="#addPersonModal" data-toggle="modal">Agregar persona
                </button>
            </div>
        </div>
    </section>


    <section class="mx-auto">
        <div id="personList" class="tableList">
            <table class="table table-striped">
                <thead>
                    <th colspan="2">
                        <input type="text" class="search form-control" id="searchPerson" placeholder="Buscar persona" />
                    </th>
                    <th colspan="3">
                        <button class="sort asc btn btn-success" data-sort="name">Nombre<i
                                class="fas fa-sort"></i></button>
                        <button class="sort asc btn btn-success" data-sort="code">Codigo<i
                                class="fas fa-sort"></i></button>
                        <button class="sort asc btn btn-success" data-sort="assistant">Asistencias<i
                                class="fas fa-sort"></i></button>
                    </th>
                    <tr class="mx-auto">
                        <th class="sort" data-sort="firstname" class="scope">Nombre</th>
                        <th class="sort" data-sort="lastname" class="scope">Apellido</th>
                        <th class="sort" data-sort="code" class="scope">Codigo</th>
                        <th class="sort" data-sort="carreer" class="scope">Carrera</th>
                        <th class="sort" data-sort="type" class="scope">Tipo</th>
                        <th class="sort" data-sort="membership" class="scope">Membresia</th>
                        <th class="sort" data-sort="cell" class="scope">Celular</th>
                        <th class="sort" data-sort="email" class="scope">Email</th>
                        <th class="sort" data-sort="assistant" class="scope">Asistencias</th>
                    </tr>
                </thead>
                <tbody class="list">
                    <tr class="itemList">
                        <td class="id" style="display:none;"></td>
                        <td class="firstname" scope="row">Jose Ricardo Romo Gutierrez</td>
                        <td class="lastname" scope="row">Jose Ricardo Romo Gutierrez</td>
                        <td class="code">2016119087</td>
                        <td class="carreer">Ingeniería Electronica</td>
                        <td class="type">Miembro</td>
                        <td class="membership">2143482432</td>
                        <td class="cell">3002715386</td>
                        <td class="email">jricardoromo21@gmail.com</td>
                        <td class="assistant">23</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
    <!-- add person Modal -->
    <div class="modal fade￼" id="addPersonModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content ">
                <div class="modal-header bg-info">
                    <h5 class="modal-title">Agregar persona</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row ">
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Nombres" id="firstname" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Apellidos" id="lastname" required>
                        </div>
                    </div>
                    <div class="row align-items-center">
                        <div class="col mt-4">
                            <input type="number" class="form-control" placeholder="Telefono" id="cell">
                        </div>
                    </div>
                    <div class="row align-items-center mt-4">
                        <div class="col">
                            <input type="email" class="form-control" placeholder="Email" id="email">
                        </div>
                    </div>
                    <div class="row align-items-center mt-4">
                        <div class="col">
                            <input type="number" class="form-control" placeholder="Codigo" id="code" required>
                        </div>
                    </div>
                    <div class="row align-items-center mt-4">
                        <div class="col">
                            <input type="number" class="form-control" placeholder="Membresia" id="membership">
                        </div>
                    </div>
                    <div class="row align-items-center mt-4 carrera">
                        <div class="col">
                            <select class="custom-select form-control" id="type">
                                <option value="Voluntario" selected>Voluntario</option>
                                <option value="Miembro">Miembro</option>
                            </select>
                        </div>
                    </div>
                    <div class="row align-items-center mt-4 carrera">
                        <div class="col">
                            <select class="custom-select form-control" id="carreer">
                                <option value="" disabled selected> Carrera o programa academico</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-success" onclick="agregarPersona()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- edit person Modal -->
    <div class="modal fade￼" id="editPersonModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content ">
                <div class="modal-header bg-info">
                    <h5 class="modal-title">Editar Persona</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <span class="card-subtitle">Nombres</span>
                    <div class="row mb-2 mt-2">
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Nombres" id="firstnameEdit" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Apellidos" id="lastnameEdit" required>
                        </div>
                    </div>
                    <span class="card-subtitle">Telefono</span>
                    <div class="row align-items-center">
                        <div class="col mt-2 mb-2">
                            <input type="number" class="form-control" placeholder="Telefono" id="cellEdit">
                        </div>
                    </div>
                    <span class="card-subtitle">Email</span>
                    <div class="row align-items-center mt-2 mb-2">
                        <div class="col">
                            <input type="email" class="form-control" placeholder="Email" id="emailEdit">
                        </div>
                    </div>
                    <span class="card-subtitle">Codigo</span>
                    <div class="row align-items-center mt-2 mb-2">
                        <div class="col">
                            <input type="number" class="form-control" placeholder="Codigo" id="codeEdit" required>
                        </div>
                    </div>
                    <span class="card-subtitle">Numero de Membresia</span>
                    <div class="row align-items-center mt-2 mb-2">
                        <div class="col">
                            <input type="number" class="form-control" placeholder="Membresia" id="membershipEdit">
                        </div>
                    </div>
                    <span class="card-subtitle">Tipo de persona</span>

                    <div class="row align-items-center mt-2 mb-2 carrera">
                        <div class="col">
                            <select class="custom-select form-control" id="typeEdit">
                                <option value="Voluntario" selected>Voluntario</option>
                                <option value="Miembro">Miembro</option>
                            </select>
                        </div>
                    </div>
                    <span class="card-subtitle">Carrera</span>

                    <div class="row align-items-center mt-2 mb-2 carrera">
                        <div class="col">
                            <select class="custom-select form-control" id="carreerEdit">
                                <option value="" disabled selected> Carrera o programa academico</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-danger" onclick="eliminarPersona()" id="deletePerson">Eliminar</button>
                    <button type="button" class="btn btn-success" onclick="editarPersona()" id="editPerson">Guardar</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-firestore.js"></script>
    <script src="../../scripts/list.js"></script>
    <script src="../../scripts/keys.js"></script>
    <script src="personas-list.js"></script>

    <script>
        var carreras = ["NO APLICA", "ADMINISTRACIÓN DE EMPRESAS", "ADMINISTRACIÓN DE EMPRESAS TURÍSTICAS Y HOTELERAS POR CICLOS PROPEDÉUTICOS",
            "ADMINISTRACIÓN DE LA SEGURIDAD Y SALUD EN EL TRABAJO POR CICLOS PROPEDÉUTICOS",
            "ADMINISTRACIÓN PÚBLICA POR CICLOS PROPEDÉUTICOS", "ANTROPOLOGÍA", "BIOLOGÍA", "CINE Y AUDIOVISUALES",
            "CONTADURÍA PÚBLICA", "DERECHO", "ECONOMÍA", "ENFERMERÍA", "INGENIERÍA AGRONÓMICA", "INGENIERÍA AMBIENTAL Y SANITARIA", "INGENIERÍA CIVIL",
            "INGENIERÍA DE SISTEMAS", "INGENIERÍA ELECTRÓNICA", "INGENIERÍA INDUSTRIAL", "INGENIERÍA PESQUERA", "LICENCIATURA EN EDUCACIÓN INFANTIL",
            "LICENCIATURA EN INFORMÁTICA", "MEDICINA", "NEGOCIOS INTERNACIONALES", "ODONTOLOGÍA", "PROFESIONAL EN DEPORTE", "PSICOLOGÍA"
        ]
        var optionsSelector = []

        carreras.forEach(e => {
            optionsSelector.push(`<option>${e}</option>`)
        })

        $("#carreer").append(optionsSelector)
        $("#carreerEdit").append(optionsSelector)

        async function agregarPersona() {

            const email = $('#email').val(); //change form to id or containment selector
            var re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/igm;
            if (email == '' || !re.test(email)) {
                alert('Por favor ingrese un email valido: ' + email);
                return false;
            }
            let formData = {
                firstname: $('#firstname').val(),
                lastname: $('#lastname').val(),
                lastname: $('#lastname').val(),
                membership: $('#membership').val(),
                cell: parseInt($('#cell').val()),
                code: parseInt($('#code').val()),
                email: $('#email').val(),
                type: $('#type').val(),
                carreer: $('#carreer').val(),
                assistant: 0,
                createdAt: firebase.firestore.Timestamp.fromDate(new Date()),
                updatedAt: firebase.firestore.Timestamp.fromDate(new Date())
            }
            console.log(`Guardando los datos de la persona: ${formData}`);

            try {
                const Person = await person.doc($('#code').val()).get()
                if (Person.exists) name = Person.data().firstname + " " + Person.data().lastname
                console.log('Person and name: ', Person, name);
                (Person.exists) ? errorSaving('Esta persona ya existe: ' + Person.data().firstname + " " + Person.data().lastname) : await person.doc($('#code').val()).set(formData)
                await personV2.doc().set(formData)
                console.log("Registrado con exito")
                $('#codeModal').modal('hide')
                alert('Se ha registrado con exito')
                $('#firstname').val('')
                $('#lastname').val('')
                $('#lastname').val('')
                $('#cell').val('')
                $('#code').val('')
                $('#membership').val('')
                $('#email').val('')
                $('#carreer').val('')
            } catch (error) {
                console.log(error);
                alert('Error al guardar en la base de datos, revise su conexion a internet o contacte con el supervisor.')
            }
            getPerson()
        }
        async function eliminarPersona() {
            try {
                await person.doc(idEditPerson).delete()
                $("#editPersonModal").modal('hide')
                alert('Persona eliminada')
            } catch (error) {
                alert('Error al eliminar a persona de la base de datos')
            }
            getPerson()
        }
    </script>

</body>

</html>